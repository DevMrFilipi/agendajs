<%- include('includes/head'); %> 
<%- include('includes/nav'); %> 
  <div class="flex relative justify-end alert-message m-6 p-4 h-4">
  <% if (errors.length > 0) { %>
  <div
    class="flex justify-center container-unsuccess items-center animate-pulse p-4 text-sm text-red-800 rounded-lg bg-red-50 "
    role="alert"
  >
    <svg
      class="flex-shrink-0 inline w-4 h-4 me-3"
      aria-hidden="true"
      xmlns="http://www.w3.org/2000/svg"
      fill="currentColor"
      viewBox="0 0 20 20"
    >
      <path
        d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"
      />
    </svg>
    <span class="sr-only">Info</span>
    <div>
      <% errors.forEach(erro => { %> <%= erro %><br />
      <% }); %>
    </div>
  </div>
  <% } %> 
  <% if (success.length > 0) { %>
  <div
    class="flex justify-center container-success animate-pulse items-center p-4 text-sm text-green-800 rounded-lg bg-green-50"
    role="alert"
  >
    <svg
      class="flex-shrink-0 inline w-4 h-4 me-3"
      aria-hidden="true"
      xmlns="http://www.w3.org/2000/svg"
      fill="currentColor"
      viewBox="0 0 20 20"
    >
      <path
        d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"
      />
    </svg>
    <span class="sr-only">Info</span>
    <div>
      <% success.forEach(success => { %> <%= success %><br />
      <% }); %>
    </div>
  </div>
  <% } %>
 </div>

<main class="md:container main-home w-full md:mx-auto my-2 bg-cream">
  
  <section class="flex section-home flex-col max-auto px-5 py-3">
    <h1 class="text-xl text-gray-700 mb-5">
      Seja Bem-Vindo a sua Lista de Contatos.
    </h1>
    <div class="flex justify-end mx-2 mb-5">
      <button
        type="button"
        onclick="openModalCadastra()"
        class="flex w-16 justify-center btn-inserir-contato rounded-md bg-indigo-600 px-3 py-1.5 text-sm font-semibold leading-6 text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"
      >
        Inserir
      </button>
    </div>
    
    <div
        id="inserirContato"
        tabindex="-1"
        aria-hidden="true"
        class="hidden overflow-y-auto overflow-x-hidden absolute top-0 right-0 left-0 z-50 justify-center bg-white/30 items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full"
      >
        <div id="dragzoneInserir"; class="relative p-4 w-full max-w-md max-h-full">
          <!-- Modal content -->
          <div
            class="relative bg-indigo-300 rounded-lg shadow dark:bg-gray-700"
          >
            <!-- Modal header -->
            <div
              id="dragableInserir"
              class="flex items-center cursor-move z-10 justify-between p-4 md:p-5 border-b rounded-t dark:border-gray-600"
            >
              <h3 class="text-xl font-semibold text-gray-900 dark:text-white">
                Cadastre seu contato.
              </h3>
              <button
                id="clsInserirContato"
                type="button"
                class="end-2.5 text-black bg-transparent hover:bg-indigo-400 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white"
                data-modal-hide="authentication-modal"
              >
                <svg
                  class="w-3 h-3"
                  aria-hidden="true"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 14 14"
                >
                  <path
                    stroke="currentColor"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"
                  />
                </svg>
                <span class="sr-only">Close modal</span>
              </button>
            </div>
            <!-- Modal body -->
            <div class="p-4 md:p-5">
              <form
                action="/cadastraContato"
                method="post"
                class="w-full form-cadastra-contato max-w-sm mx-auto bg-white p-8 rounded-md shadow-md"
              >
              <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
                <div class="mb-4">
                  <label
                    class="block text-gray-700 text-sm font-bold mb-2"
                    for="name"
                    >Nome</label
                  >
                  <input
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-indigo-500"
                    type="text"
                    id="name"
                    name="name"
                    placeholder="Filipi"
                  />
                </div>
                <div class="mb-4">
                  <label
                    class="block text-gray-700 text-sm font-bold mb-2"
                    for="lastName"
                    >Sobrenome</label
                  >
                  <input
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-indigo-500"
                    type="text"
                    id="lastName"
                    name="lastName"
                    placeholder="Serpa"
                  />
                </div>
                <div class="mb-4">
                  <label
                    class="block text-gray-700 text-sm font-bold mb-2"
                    for="phone"
                    >Telefone</label
                  >
                  <input
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-indigo-500"
                    type="text"
                    id="phone"
                    name="phone"
                    placeholder="+1 233 2445-2233"
                  />
                </div>
                <div class="mb-4">
                  <label
                    class="block text-gray-700 text-sm font-bold mb-2"
                    for="mail"
                    >E-mail</label
                  >
                  <input
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-indigo-500"
                    type="email"
                    id="mail"
                    name="mail"
                    placeholder="example@mail.com"
                  />
                </div>
                <div class="flex justify-center">
                  <button
                    class="w-28 bg-indigo-500 text-white text-sm font-bold py-2 px-4 mx-3 rounded-md hover:bg-indigo-600 transition duration-300"
                    type="submit"
                  >
                    Registrar
                  </button>
                  <button
                    class="w-28 bg-red-500 text-white text-sm font-bold py-2 px-4 rounded-md hover:bg-red-600 transition duration-300"
                    id="btnCancelarContato"
                    type="button"
                  >
                    Cancelar
                  </button>
                </div>
              </form>
            </div>            
          </div>
        </div>
    </div>

    <div
        id="editarContato"
        tabindex="-1"
        aria-hidden="true"
        class="hidden overflow-y-auto overflow-x-hidden absolute top-0 right-0 left-0 z-50 justify-center bg-white/30 items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full"
      >
        <div id="dragzoneEditar" ; class="relative p-4 w-full max-w-md max-h-full">
          <!-- Modal content -->
          <div
            class="relative bg-indigo-300 rounded-lg shadow dark:bg-gray-700"
          >
            <!-- Modal header -->
            <div
              id="dragableEditar"
              class="flex items-center cursor-move z-10 justify-between p-4 md:p-5 border-b rounded-t dark:border-gray-600"
            >
              <h3 class="text-xl font-semibold text-gray-900 dark:text-white">
                Edite seu contato.
              </h3>
              <button
                id="btnClsEditarContato"
                type="button"
                class="end-2.5 text-black bg-transparent hover:bg-indigo-400 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white"
                data-modal-hide="authentication-modal"
              >
                <svg
                  class="w-3 h-3"
                  aria-hidden="true"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 14 14"
                >
                  <path
                    stroke="currentColor"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"
                  />
                </svg>
                <span class="sr-only">Close modal</span>
              </button>
            </div>
            <!-- Modal body -->
            <div class="p-4 md:p-5">
              <form
                id="formEdit"
                method="post"
                class="w-full max-w-sm form-edita-contato mx-auto bg-white p-8 rounded-md shadow-md"
              >
                <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
                <div class="mb-4">
                  <label
                    class="block text-gray-700 text-sm font-bold mb-2"
                    for="name"
                    >Nome</label
                  >
                  <input
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-indigo-500"
                    type="text"
                    id="editName"
                    name="name"
                    placeholder="Filipi"
                  />
                </div>
                <div class="mb-4">
                  <label
                    class="block text-gray-700 text-sm font-bold mb-2"
                    for="lastName"
                    >Sobrenome</label
                  >
                  <input
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-indigo-500"
                    type="text"
                    id="editLastName"
                    name="lastName"
                    placeholder="Serpa"
                  />
                </div>
                <div class="mb-4">
                  <label
                    class="block text-gray-700 text-sm font-bold mb-2"
                    for="phone"
                    >Telefone</label
                  >
                  <input
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-indigo-500"
                    type="text"
                    id="editPhone"
                    name="phone"
                    placeholder="+1 233 2445-2233"
                  />
                </div>
                <div class="mb-4">
                  <label
                    class="block text-gray-700 text-sm font-bold mb-2"
                    for="mail"
                    >E-mail </label
                  >
                  <input
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-indigo-500"
                    type="email"
                    id="editMail"
                    name="mail"
                    placeholder="example@mail.com"
                  />
                </div>
                <div class="flex justify-center">
                  <button
                    class="w-28 bg-indigo-500 text-white text-sm font-bold py-2 px-4 mx-3 rounded-md hover:bg-indigo-600 transition duration-300"
                    type="submit"
                  >
                    Editar       
                  </button>
                  <button
                    class="w-28 bg-red-500 text-white text-sm font-bold py-2 px-4 rounded-md hover:bg-red-600 transition duration-300"
                    id="btnCancelarEditarContato"
                    type="button"
                    action="/"
                  >
                    Cancelar
                  </button>
                </div>
              </form>
            </div>        
          </div>
        </div>
      </div>

    <% if (contatos.length > 0) { %>
      <div class="relative overflow-x-auto">
        <table
          class="w-full text-sm text-left rtl:text-right text-gray-800 dark:text-gray-400"
        >
          <thead
            class="text-xs text-gray-700 uppercase bg-gray-100 dark:bg-gray-700 dark:text-gray-400"
          >
            <tr>
              <th scope="col" class="px-6 py-3">NOME</th>
              <th scope="col" class="px-6 py-3">SOBRENOME</th>
              <th scope="col" class="px-6 py-3">TELEFONE</th>
              <th scope="col" class="px-6 py-3">E-MAIL</th>
              <th scope="col" class="justify-center px-6 py-3">AÇÕES</th>
            </tr>
          </thead>
          <tbody>
            <% contatos.forEach(contato => { %>
              <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700">
                <td class="hidden" id="<%= contato.id %>"></td>
                <td class="px-6 py-4"><%= contato.name %></td>
                <td class="px-6 py-4"><%= contato.lastName %></td>
                <td class="px-6 py-4"><%= contato.phone %></td>
                <td class="px-6 py-4"><%= contato.mail %></td>
                <td class="px-4 py-2">
                  <div class="flex justify-center">
                    <a class="m-2" href="#" onclick="openModalEditContato('<%= contato.id %>', '<%= contato.name %>', '<%= contato.lastName %>', '<%= contato.phone %>', '<%= contato.mail %>')">
                      <svg class="w-6 h-6 text-blue-800 dark:text-white hover:text-blue-600" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.779 17.779 4.36 19.918 6.5 13.5m4.279 4.279 8.364-8.643a3.027 3.027 0 0 0-2.14-5.165 3.03 3.03 0 0 0-2.14.886L6.5 13.5m4.279 4.279L6.499 13.5m2.14 2.14 6.213-6.504M12.75 7.04 17 11.28"/>
                      </svg>
                    </a>
                    <a class="m-2 h-2" href="./deletarContato/<%= contato.id %>">
                      <svg class="w-6 h-6 text-red-500 dark:text-white hover:text-red-800" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 15v3c0 .5523.44772 1 1 1h16c.5523 0 1-.4477 1-1v-3M3 15V6c0-.55228.44772-1 1-1h16c.5523 0 1 .44772 1 1v9M3 15h18M8 15v4m4-4v4m4-4v4m-5.5061-7.4939L12 10m0 0 1.5061-1.50614M12 10l1.5061 1.5061M12 10l-1.5061-1.50614"/>
                      </svg>
                    </a>
                  </div>
                </td>
              </tr>
            <% }); %>
          </tbody>
        </table>
      </div>
    <% } else { %>
      <p class="text-center"> Não há contatos em sua Agenda.</p>
    <% } %>
  </section>
</main>
<%- include ('includes/script')%>
<%- include ('includes/footer'); %>
